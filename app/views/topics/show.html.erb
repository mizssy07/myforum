<h1><%= @topic.title %></h1>

<% if @posts.count >= 1 %>
  <% @posts.each.with_index(1) do |post, idx| %>
    <div class="panel panel-default">
      <div class="panel-heading">
        <div class="panel-title">
          <%= idx %>. <%= post.name %>
          <input type="hidden" name="id" value="<%= post.id %>">
          <% if @current_user && post.user_id == @current_user.id %>
            <%= link_to("削除",
                        "/posts/delete/#{post.id}",
                        {method: "post",
                         data: {confirm: "削除してもよろしいですか？"},
                         class: "badge badge-dark pull-right"}) %>
          <% end %>
        </div>
      </div>
      <div class="panel-body">
        <%= post.content %>
      </div>
    </div>
  <% end %>
<% else %>
  <h3>まだ書き込みはありません</h3>
<% end %>

<% if @current_user %>
  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">
        新規投稿
      </div>
      <%= form_tag("/posts/create") do %>
        名前:<input name="name" value="名無しさん" ><br>
        本文:<textarea name="content"></textarea>
        <input type="hidden" name="topic_id" value="<%= @topic.id %>">
        <input type="hidden" name="user_id" value="<%= @current_user.id %>">
        <input type="submit" value="投稿">
      <% end %>
    </div>
  </div>
<% end %>